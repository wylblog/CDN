<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
    <meta name="referrer" content="origin">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>
        
            04.消息队列-zookeeper+kafka
        
    </title>
    <link rel="shortcut icon" href="#"/>

    <link type="text/css" rel="stylesheet" href="/font/LongCang.css">
    <link type="text/css" rel="stylesheet" href="/font/Monda.css">
    <link type="text/css" rel="stylesheet" href="/font/NotoSansSC.css">
    <link type="text/css" rel="stylesheet" href="/font/NotoSerifSC.css">
    <link type="text/css" rel="stylesheet" href="/font/Playball.css">
    <link type="text/css" rel="stylesheet" href="/font/PTMono.css">
    <link type="text/css" rel="stylesheet" href="/font/Roboto.css">
    <link type="text/css" rel="stylesheet" href="/font/RobotoSlab.css">
    <link type="text/css" rel="stylesheet" href="/font/Rosario.css">
    <link type="text/css" rel="stylesheet" href="/font/UbuntuMono.css">

    <link type="text/css" rel="stylesheet" href="/css/base.css">
    <link type="text/css" rel="stylesheet" href="/css/code.css">

    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <a id="cover"></a>
    <link type="text/css" rel="stylesheet" href="/css/post.css">
<div id="header" class="header">
    <div class="vertical">
        <div class="inner">
            
                <h1 class="header-subtitle">04.消息队列-zookeeper+kafka</h1>
                <div class="header-subinfo">
                    <p class="article-info-text">
                        <span>
                            <i class="iconfont icon-time"></i> 发表时间：2024-11-08
                        </span>
                        
                            
                                <span id="/2024/11/08/04-消息队列-zookeeper-kafka/" class="leancloud_visitors" data-flag-title="04.消息队列-zookeeper+kafka">
                                    <i class="iconfont icon-browse"></i> 阅读：<sapn class="leancloud-visitors-count"></span>
                                </span>
                            
                            
                                <span>
                                    <i class="iconfont icon-interactive"></i> 评论：<span class="valine-comment-count" data-xid="/2024/11/08/04-消息队列-zookeeper-kafka/"></span>
                                </span>
                              
                        
                    </p>
                    
                    
                        
                            <span class="tag-color">大数据运维</span>
                        
                    
                </div>
            
        </div>
    </div>
    
</div>
<div id="container">
    
        <!-- 文章页面 -->
        <div id="article">
            <div class="toc"></div>
            <div class="article-body">
                <p>categories:</p>
<ul>
<li>大数据系列</li>
</ul>
<h1 id="4-消息队列-zookeeper-kafka"><a href="#4-消息队列-zookeeper-kafka" class="headerlink" title="4. 消息队列-zookeeper+kafka"></a>4. 消息队列-zookeeper+kafka</h1><h2 id="1-kafka"><a href="#1-kafka" class="headerlink" title="1. kafka"></a>1. kafka</h2><p>工作原理：</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051534184.png" alt="图片"></p>
<p><strong>Producer：</strong> 生产者，发送消息的一方。生产者负责创建消息，然后将其发送到 Kafka。<br><strong>Consumer：</strong> 消费者，接受消息的一方。消费者连接到 Kafka 上并接收消息，进而进行相应的业务逻辑处理。<br><strong>Consumer Group：</strong> 一个消费者组可以包含一个或多个消费者。使用多分区 + 多消费者方式可以极大提高数据下游的处理速度，同一消费组中的消费者不会重复消费消息，同样的，不同消费组中的消费者消息消息时互不影响。Kafka 就是通过消费组的方式来实现消息 P2P 模式和广播模式。<br><strong>Broker：</strong> 服务代理节点。Broker 是 Kafka 的服务节点，即 Kafka 的服务器。<br><strong>Topic：</strong> Kafka 中的消息以 Topic 为单位进行划分，生产者将消息发送到特定的 Topic，而消费者负责订阅 Topic 的消息并进行消费。<br><strong>Partition：</strong> Topic 是一个逻辑的概念，它可以细分为多个分区，每个分区只属于单个主题。同一个主题下不同分区包含的消息是不同的，分区在存储层面可以看作一个可追加的日志（Log）文件，消息在被追加到分区日志文件的时候都会分配一个特定的偏移量（offset）。<br><strong>Offset：</strong> offset 是消息在分区中的唯一标识，Kafka 通过它来保证消息在分区内的顺序性，不过 offset 并不跨越分区，也就是说，Kafka 保证的是分区有序性而不是主题有序性。<br><strong>Replication：</strong> 副本，是 Kafka 保证数据高可用的方式，Kafka 同一 Partition 的数据可以在多 Broker 上存在多个副本，通常只有主副本对外提供读写服务，当主副本所在 broker 崩溃或发生网络异常，Kafka 会在 Controller 的管理下会重新选择新的 Leader 副本对外提供读写服务。<br><strong>Record：</strong> 实际写入 Kafka 中并可以被读取的消息记录。每个 record 包含了 key、value 和 timestamp。</p>
<h3 id="1-1生产者-消费者"><a href="#1-1生产者-消费者" class="headerlink" title="1.1生产者-消费者"></a>1.1生产者-消费者</h3><p><code>生产者</code>-<code>消费者</code>是一种设计模式，<code>生产者</code>和<code>消费者</code>之间通过添加一个<code>中间组件</code>来达到解耦。<code>生产者</code>向<code>中间组件</code>生成数据，<code>消费者</code>消费数据。</p>
<p>就像 65 哥读书时给小芳写情书，这里 65 哥就是<code>生产者</code>，情书就是<code>消息</code>，小芳就是<code>消费者</code>。但有时候小芳不在，或者比较忙，65 哥也比较害羞，不敢直接将情书塞小芳手里，于是将情书塞在小芳抽屉中。所以抽屉就是这个<code>中间组件</code>。</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051534059.png" alt="图片"></p>
<p>在程序中我们通常使用<code>Queue</code>来作为这个<code>中间组件</code>。可以使用多线程向队列中写入数据，另外的消费者线程依次读取队列中的数据进行消费。模型如下图所示：</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051534683.png" alt="图片"></p>
<p><code>生产者</code>-<code>消费者</code>模式通过添加一个中间层，不仅可以解耦生产者和消费者，使其易于扩展，还可以异步化调用、缓冲消息等。</p>
<h3 id="1-1-3-分布式队列"><a href="#1-1-3-分布式队列" class="headerlink" title="1.1.3 分布式队列"></a>1.1.3 分布式队列</h3><p>后来 65 哥和小芳异地了，65 哥在<code>卷都</code>奋斗，小芳在<code>魔都</code>逛街。于是只能通过<code>邮局</code>寄暧昧信了。这样 65 哥、邮局和小芳就成了<code>分布式</code>的了。65 哥将信件发给邮局，小芳从邮局拿到 65 哥写的信，再回去慢慢看。</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401041627267.png" alt="图片"></p>
<p>Kafka 的消息<code>生产者</code>就是<code>Producer</code>，上游消费者进程添加 Kafka Client 创建 Kafka Producer，向 Broker 发送消息，Broker 是集群部署在远程服务器上的 Kafka Server 进程，下游消费者进程引入 Kafka Consumer API 持续消费队列中消息。</p>
<p>因为 Kafka Consumer 使用 Poll 的模式，需要 Consumer 主动拉去消息。所有小芳只能定期去邮局拿信件了(呃，果然主动权都在小芳手上啊)。</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051534718.png" alt="图片"></p>
<h3 id="1-1-4-主题"><a href="#1-1-4-主题" class="headerlink" title="1.1.4 主题"></a>1.1.4 主题</h3><p>邮局不能只为 65 哥服务，虽然 65 哥一天写好几封信。但也无法挽回邮局的损失。所以邮局是可以供任何人寄信。只需要寄信人写好地址(主题)，邮局建有两地的通道就可以发收信件了。</p>
<p>Kafka 的 Topic 才相当于一个队列，Broker 是所有队列部署的机器。可以按业务创建不同的 Topic，Producer 向所属业务的 Topic 发送消息，相应的 Consumer 可以消费并处理消息。</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051534283.png" alt="图片"></p>
<h3 id="1-1-5-分区"><a href="#1-1-5-分区" class="headerlink" title="1.1.5 分区"></a>1.1.5 分区</h3><p>由于 65 哥写的信太多，一个邮局已经无法满足 65 哥的需求，邮政公司只能多建几个邮局了，65 哥将信件按私密度分类(分区策略)，从不同的邮局寄送。</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051534012.png" alt="图片"></p>
<p>同一个 Topic 可以创建多个分区。理论上分区越多并发度越高，Kafka 会根据分区策略将分区尽可能均衡的分布在不同的 Broker 节点上，以避免消息倾斜，不同的 Broker 负载差异太大。分区也不是越多越好哦，毕竟太多邮政公司也管理不过来</p>
<h3 id="1-1-6-副本"><a href="#1-1-6-副本" class="headerlink" title="1.1.6 副本"></a>1.1.6 副本</h3><p>为防止由于邮局的问题，比如交通断啦，邮车没油啦。导致 65 哥的暧昧信无法寄到小芳手上，使得 65 哥晚上远程跪键盘。邮局决定将 65 哥的信件复制几份发到多个正常的邮局，这样只要有一个邮局还在，小芳就可以收到 65 哥的信了。</p>
<p>Kafka 采用分区副本的方式来保证数据的高可用，每个分区都将建立指定数量的副本数，kakfa 保证同一分区副本尽量分布在不同的 Broker 节点上，以防止 Broker 宕机导致所有副本不可用。Kafka 会为分区的多个副本选举一个作为主副本(Leader)，主副本对外提供读写服务，从副本(Follower)实时同步 Leader 的数据。</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401041627512.png" alt="图片"></p>
<h3 id="1-1-7-多消费者"><a href="#1-1-7-多消费者" class="headerlink" title="1.1.7 多消费者"></a>1.1.7 多消费者</h3><p>哎，65 哥的信件满天飞，小芳天天跑邮局，还要一一拆开看，65 哥写的信又臭又长，让小芳忙得满身大汗。于是小芳啪的一下，很快啊，变出多个分身去不同的邮局取信，这样小芳终于可以挤出额外的时间逛街了。</p>
<h3 id="1-1-8-广播消息"><a href="#1-1-8-广播消息" class="headerlink" title="1.1.8 广播消息"></a>1.1.8 广播消息</h3><p>邮局最近提供了定制明信片业务，每个人都可以设计明信片，同一个身份只能领取一种明信片。65 哥设计了一堆，广播给所有漂亮的小妹妹都可以来领取，美女啪变出的分身也可以来领取，但是同一个身份的多个分身只能取一种明信片。</p>
<p>Kafka 通过 Consumer Group 来实现广播模式消息订阅，即不同 group 下的 consumer 可以重复消费消息，相互不影响，同一个 group 下的 consumer 构成一个整体。</p>
<p><strong>最后我们完成了 Kafka 的整体架构，如下：</strong></p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401041627648.png" alt="图片"></p>
<h2 id="2-Zookeeper"><a href="#2-Zookeeper" class="headerlink" title="2. Zookeeper"></a>2. Zookeeper</h2><p>Zookeeper 是一个成熟的分布式协调服务，它可以为分布式服务提供分布式配置服务、同步服务和命名注册等能力.。对于任何分布式系统，都需要一种协调任务的方法。Kafka 是使用 ZooKeeper 而构建的分布式系统。但是也有一些其他技术（例如 Elasticsearch 和 MongoDB）具有其自己的内置任务协调机制。</p>
<p>Kafka 将 Broker、Topic 和 Partition 的元数据信息存储在 Zookeeper 上。通过在 Zookeeper 上建立相应的数据节点，并监听节点的变化，Kafka 使用 Zookeeper 完成以下功能：</p>
<ul>
<li>Kafka Controller 的 Leader 选举</li>
<li>Kafka 集群成员管理</li>
<li>Topic 配置管理</li>
<li>分区副本管理</li>
</ul>
<p>我们看一看 Zookeeper 下 Kafka 创建的节点，即可一目了然的看出这些相关的功能。</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051534155.png" alt="图片"></p>
<p><strong>实验环境</strong></p>
<table>
<thead>
<tr>
<th>容器系统</th>
<th>容器主机名</th>
<th>容器ip</th>
<th>容器用户名</th>
</tr>
</thead>
<tbody><tr>
<td>centos7</td>
<td>master</td>
<td>192.168.1.10</td>
<td>root</td>
</tr>
<tr>
<td>centos7</td>
<td>slave1</td>
<td>192.168.1.20</td>
<td>root</td>
</tr>
<tr>
<td>centos7</td>
<td>slave2</td>
<td>192.168.1.30</td>
<td>root</td>
</tr>
</tbody></table>
<blockquote>
<p>前提:已配置好java环境</p>
</blockquote>
<h2 id="3-zookeeper分布式部署"><a href="#3-zookeeper分布式部署" class="headerlink" title="3. zookeeper分布式部署"></a>3. zookeeper分布式部署</h2><h3 id="3-1-解压所需压缩包并重命名"><a href="#3-1-解压所需压缩包并重命名" class="headerlink" title="3.1 解压所需压缩包并重命名"></a>3.1 解压所需压缩包并重命名</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf /opt/software/zookeeper-3.4.6.tar.gz -C /opt/module/</span><br><span class="line">[root@master ~]# <span class="built_in">mv</span> /opt/module/zookeeper-3.4.6/ /opt/module/zookeeper</span><br></pre></td></tr></table></figure>

<h3 id="3-2-配置环境变量"><a href="#3-2-配置环境变量" class="headerlink" title="3.2 配置环境变量"></a>3.2 配置环境变量</h3><blockquote>
<p>所有节点添加</p>
</blockquote>
<p>添加环境变量:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#zookeeper</span></span><br><span class="line"><span class="built_in">export</span> ZK_HOME=/opt/module/zookeeper</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZK_HOME</span>/bin</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt;/etc/profile&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#zookeeper</span></span><br><span class="line"><span class="string">export ZK_HOME=/opt/module/zookeeper</span></span><br><span class="line"><span class="string">export PATH=\$PATH:\$ZK_HOME/bin</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>刷新生效:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<h3 id="3-3-配置zoo-cfg文件"><a href="#3-3-配置zoo-cfg文件" class="headerlink" title="3.3 配置zoo.cfg文件"></a>3.3 配置zoo.cfg文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">创建数据目录和日志目录</span><br><span class="line">[root@master ~]# <span class="built_in">mkdir</span> /opt/module/zookeeper/&#123;data,logs&#125;</span><br><span class="line">[root@master ~]# <span class="built_in">cp</span> /opt/module/zookeeper/conf/zoo_sample.cfg /opt/module/zookeeper/conf/zoo.cfg</span><br><span class="line">[root@master ~]# vi /opt/module/zookeeper/conf/zoo.cfg</span><br></pre></td></tr></table></figure>

<blockquote>
<p>配置内容如下:</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]# <span class="built_in">cat</span> zoo.cfg </span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/opt/module/zookeeper/data</span><br><span class="line">dataLogDir=/opt/module/zookeeper/logs</span><br><span class="line">clientPort=2181</span><br><span class="line">server.1=master:2888:3888</span><br><span class="line">server.2=slave1:2888:3888</span><br><span class="line">server.3=slave2:2888:3888</span><br></pre></td></tr></table></figure>

<p>配置详解:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@kafka1 opt]# grep -Ev <span class="string">&quot;#|^$&quot;</span> /usr/local/zookeeper/conf/zoo.cfg </span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/opt/module/zookeeper/data</span><br><span class="line">dataLogDir=/opt/module/zookeeper/logs</span><br><span class="line">clientPort=2181</span><br><span class="line">maxClientCnxns=4096	<span class="comment">#(可选)</span></span><br><span class="line">autopurge.snapRetainCount=128   <span class="comment"># /opt/zookeeper里保存快照的最大数量(可选)</span></span><br><span class="line">autopurge.purgeInterval=1   <span class="comment"># 几小时清理一次(可选)</span></span><br><span class="line"><span class="comment"># 可以用主机名，因为设置了映射</span></span><br><span class="line">server.1=master:2888:3888</span><br><span class="line">server.2=slave1:2888:3888</span><br><span class="line">server.3=slave2:2888:3888</span><br><span class="line"></span><br><span class="line">配置参数解读：</span><br><span class="line">server.A=B:C:D</span><br><span class="line"></span><br><span class="line">A是一个数字，表示这个是第几号服务器。myid中的编号就是这个值。zookeeper启动时读取此文件，拿到里面的数据与zoo.cfg里面的配置信息比较从而判断到底是哪个server。</span><br><span class="line">B是这个服务器的地址。</span><br><span class="line">C是这个服务器Follower与集群中的Leader服务器交换信息的端口。</span><br><span class="line">D是万一集群中的leader服务器挂了，需要一个端口来重新进行选举，选举一个新的leader，而这个端口就是用来执行选举时服务器相互通信的端口。</span><br></pre></td></tr></table></figure>

<p>结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051623327.png" alt="image-20240105162313246"></p>
<h3 id="3-4-配置myid文件"><a href="#3-4-配置myid文件" class="headerlink" title="3.4 配置myid文件"></a>3.4 配置<code>myid</code>文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master zookeeper]# <span class="built_in">echo</span> 1 &gt; <span class="variable">$ZK_HOME</span>/data/myid</span><br></pre></td></tr></table></figure>

<h3 id="3-5-分发文件给子节点并分别修改myid文件"><a href="#3-5-分发文件给子节点并分别修改myid文件" class="headerlink" title="3.5 分发文件给子节点并分别修改myid文件"></a>3.5 分发文件给子节点并分别修改myid文件</h3><blockquote>
<p>:warning:注意:如果子节点没有配置环境变量,也要一同分发</p>
</blockquote>
<p>分发:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# scp -r /opt/module/zookeeper/ root@slave1:/opt/module/</span><br><span class="line">[root@master ~]# scp -r /opt/module/zookeeper/ root@slave2:/opt/module/</span><br></pre></td></tr></table></figure>

<p>修改myid文件:</p>
<p>slave1:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@slave1 ~]# <span class="built_in">echo</span> 2 &gt; /opt/module/zookeeper/data/myid</span><br><span class="line">[root@slave1 ~]# <span class="built_in">echo</span> 2 &gt; <span class="variable">$ZK_HOME</span>/data/myid</span><br></pre></td></tr></table></figure>

<p>slave2:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@slave2 ~]# <span class="built_in">echo</span> 3 &gt; /opt/module/zookeeper/data/myid</span><br><span class="line">[root@slave2 ~]# <span class="built_in">echo</span> 3 &gt; <span class="variable">$ZK_HOME</span>/data/myid</span><br></pre></td></tr></table></figure>

<h3 id="3-6-编写脚本启动zk服务-可选"><a href="#3-6-编写脚本启动zk服务-可选" class="headerlink" title="3.6 编写脚本启动zk服务(可选)"></a>3.6 编写脚本启动zk服务(可选)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vi /opt/module/zookeeper/bin/zk.sh</span><br><span class="line">[root@master ~]# vi <span class="variable">$ZK_HOME</span>/bin/zk.sh</span><br></pre></td></tr></table></figure>

<p>脚本内容如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;start&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=======启动zookeeper集群==============&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> master slave1 slave2;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;---------------启动<span class="variable">$i</span>-------------&quot;</span></span><br><span class="line">	ssh <span class="variable">$i</span> <span class="string">&quot;source /etc/profile;<span class="variable">$&#123;ZK_HOME&#125;</span>/bin/zkServer.sh start&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;stop&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;========关闭zookeeper集群============&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> master slave1 slave2;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;---------------关闭<span class="variable">$i</span>-------------&quot;</span></span><br><span class="line">	ssh <span class="variable">$i</span> <span class="string">&quot;source /etc/profile;<span class="variable">$&#123;ZK_HOME&#125;</span>/bin/zkServer.sh stop&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;status&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=======查看zookeeper集群节点状态=========&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> master slave1 slave2;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;---------------查看<span class="variable">$i</span>-------------&quot;</span></span><br><span class="line">	ssh <span class="variable">$i</span> <span class="string">&quot;source /etc/profile;<span class="variable">$&#123;ZK_HOME&#125;</span>/bin/zkServer.sh status&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请输入start或stop或status!!!&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>添加可执行权限</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">chmod</span> +x <span class="variable">$ZK_HOME</span>/bin/zk.sh</span><br></pre></td></tr></table></figure>

<p>查看是否添加成功:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ll /opt/module/zookeeper/bin/</span><br></pre></td></tr></table></figure>

<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051645489.png" alt="image-20240105164512437"></p>
<h3 id="3-7-启动zk服务"><a href="#3-7-启动zk服务" class="headerlink" title="3.7 启动zk服务"></a>3.7 启动zk服务</h3><blockquote>
<p>方法1:绝对路径启动服务</p>
</blockquote>
<p>所有节点启动:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/zookeeper/bin/zkServer.sh start</span><br></pre></td></tr></table></figure>

<p>查看启动状态:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/zookeeper/bin/zkServer.sh status</span><br></pre></td></tr></table></figure>



<p>master:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051653792.png" alt="image-20240105165336746"></p>
<p>slave1:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051653394.png" alt="image-20240105165353343"></p>
<p>slave2:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051654004.png" alt="image-20240105165433958"></p>
<blockquote>
<p>方法2:脚本一键启动服务</p>
</blockquote>
<p>启动:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# zk.sh start</span><br></pre></td></tr></table></figure>

<p>结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051701915.png" alt="image-20240105170128847"></p>
<p>查看服务状态:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# zk.sh status</span><br></pre></td></tr></table></figure>

<p>结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051701409.png" alt="image-20240105170159352"></p>
<p>zookeeper集群部署完成</p>
<h2 id="4-kafka分布式部署"><a href="#4-kafka分布式部署" class="headerlink" title="4. kafka分布式部署"></a>4. kafka分布式部署</h2><h3 id="4-1解压所需压缩包并重命名"><a href="#4-1解压所需压缩包并重命名" class="headerlink" title="4.1解压所需压缩包并重命名"></a>4.1解压所需压缩包并重命名</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxf /opt/software/kafka_2.12-2.4.1.tgz -C /opt/module/</span><br><span class="line">[root@master ~]# <span class="built_in">mv</span> /opt/module/kafka_2.12-2.4.1/ /opt/module/kafka</span><br></pre></td></tr></table></figure>

<h3 id="4-2-配置环境变量"><a href="#4-2-配置环境变量" class="headerlink" title="4.2 配置环境变量"></a>4.2 配置环境变量</h3><blockquote>
<p>所有节点添加</p>
</blockquote>
<p>添加环境变量:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt;/etc/profile&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#kafka</span></span><br><span class="line"><span class="string">export KAFKA_HOME=/opt/module/kafka</span></span><br><span class="line"><span class="string">export PATH=\$PATH:\$KAFKA_HOME/bin</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>刷新生效:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>查看kafka版本号:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --version</span><br></pre></td></tr></table></figure>

<p>结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051711698.png" alt="image-20240105171153639"></p>
<h3 id="4-3-配置server-properties文件"><a href="#4-3-配置server-properties文件" class="headerlink" title="4.3 配置server.properties文件"></a>4.3 配置server.properties文件</h3><p>添加内容如下:</p>
<blockquote>
<p>注意删除后面的备注</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@master config]# grep -Ev <span class="string">&quot;^$|^#&quot;</span> server.properties </span><br><span class="line">broker.id=0	<span class="comment"># 节点id要唯一</span></span><br><span class="line">listeners=PLAINTEXT://master:9092	<span class="comment"># 改成本机ip,如果配置好主机映射即可使用主机名</span></span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/opt/module/kafka/kafka-logs	<span class="comment"># 储存日志文件</span></span><br><span class="line">num.partitions=1	<span class="comment">#这个参数用于设置新创建的topic有多少个分区，可以根据消费者实际情况配置</span></span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168		<span class="comment">#这个参数用于配置kafka中消息保存的时间，还支持log.retention.minutes和log.retention.ms配置项</span></span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=master:2181,slave1:2181,slave2:2181	<span class="comment"># 所有节点的ip或者映射</span></span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br></pre></td></tr></table></figure>

<p>主要修改添加如下,剩下的默认就好:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051813891.png" alt="image-20240105181359825"></p>
<h3 id="4-4-分发文件给子节点并分别修改broker-id-和-listener-ip"><a href="#4-4-分发文件给子节点并分别修改broker-id-和-listener-ip" class="headerlink" title="4.4 分发文件给子节点并分别修改broker.id  和 listener ip"></a>4.4 分发文件给子节点并分别修改<code>broker.id </code> 和 <code>listener ip</code></h3><p>分发:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master module]# scp -r /opt/module/kafka/ root@slave1:/opt/module/</span><br><span class="line">[root@master module]# scp -r /opt/module/kafka/ root@slave2:/opt/module/</span><br></pre></td></tr></table></figure>

<p>修改子节点配置:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/module/kafka/config/server.properties</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改的部分如下:</p>
</blockquote>
<p>slave1:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051815449.png" alt="image-20240105181507378"></p>
<p>slave2:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051815144.png" alt="image-20240105181523083"></p>
<h3 id="4-5-编写启动脚本-可选"><a href="#4-5-编写启动脚本-可选" class="headerlink" title="4.5 编写启动脚本(可选)"></a>4.5 编写启动脚本(可选)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/module/kafka/bin/kafka.sh</span><br><span class="line">vi <span class="variable">$KAFKA_HOME</span>/bin/kafka.sh</span><br><span class="line"><span class="built_in">chmod</span> +x /opt/module/kafka/bin/kafka.sh</span><br><span class="line"><span class="built_in">chmod</span> +x <span class="variable">$KAFKA_HOME</span>/bin/kafka.sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>脚本内容如下:</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;start&quot;</span>)</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;=======启动kafka集群==============&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> master slave1 slave2;<span class="keyword">do</span></span><br><span class="line">	  <span class="built_in">echo</span> <span class="string">&quot;---------------启动<span class="variable">$i</span>-------------&quot;</span></span><br><span class="line">	  ssh <span class="variable">$i</span> <span class="string">&quot;source /etc/profile;<span class="variable">$&#123;KAFKA_HOME&#125;</span>/bin/kafka-server-start.sh -daemon <span class="variable">$KAFKA_HOME</span>/config/server.properties&quot;</span></span><br><span class="line">	  <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">	    <span class="built_in">echo</span> -e <span class="string">&#x27;\033[32m&gt;&gt;$i kafka服务启动成功!! \033[0m&#x27;</span></span><br><span class="line">	  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;stop&quot;</span>)</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;========关闭kafka集群============&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> master slave1 slave2;<span class="keyword">do</span></span><br><span class="line">	  <span class="built_in">echo</span> <span class="string">&quot;---------------关闭<span class="variable">$i</span>-------------&quot;</span></span><br><span class="line">	  ssh <span class="variable">$i</span> <span class="string">&quot;source /etc/profile;<span class="variable">$&#123;KAFKA_HOME&#125;</span>/bin/kafka-server-stop.sh&quot;</span></span><br><span class="line">          <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&#x27;\033[32m&gt;&gt;$i kafka服务关闭成功!! \033[0m&#x27;</span></span><br><span class="line">          <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;请输入start或stop!!!&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>



<h3 id="4-6-启动kafka服务"><a href="#4-6-启动kafka服务" class="headerlink" title="4.6 启动kafka服务"></a>4.6 启动kafka服务</h3><blockquote>
<p>方式1:绝对路径启动服务</p>
</blockquote>
<p>所有节点启动:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties</span><br></pre></td></tr></table></figure>

<p>结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051807297.png" alt="image-20240105180718227"></p>
<blockquote>
<p>方式2:脚本一键启动</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kafka.sh start</span><br></pre></td></tr></table></figure>

<p>结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051823163.png"></p>
<p>查看进程:</p>
<p>​        <img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051823384.png"></p>
<p>部署完成!!!</p>
<h2 id="5-kafka集群基本命令操作"><a href="#5-kafka集群基本命令操作" class="headerlink" title="5. kafka集群基本命令操作"></a>5. kafka集群基本命令操作</h2><p>kefka提供了多个命令用于查看、创建、修改、删除topic信息，也可以通过命令测试如何生产消息、消费消息等，这些命令位于kafka安装目录的bin目录下，这里是&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;bin。登录任意一台kafka集群节点，切换到此目录下，即可进行命令操作。下面列举kafka的一些常用命令的使用方法。</p>
<p><strong>创建主题与测试</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kafka-topics.sh --create --zookeeper master:2181,slave1:2181,slave2:2181 --partitions 3 --replication-factor 3 --topic <span class="built_in">test</span></span><br><span class="line">Created topic <span class="built_in">test</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证topic</span></span><br><span class="line">[root@master ~]# kafka-topics.sh --describe --zookeeper master:2181,slave1:2181,slave2:2181 --topic <span class="built_in">test</span></span><br><span class="line">Topic: <span class="built_in">test</span>	PartitionCount: 3	ReplicationFactor: 3	Configs: </span><br><span class="line">	Topic: <span class="built_in">test</span>	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 0,1,2</span><br><span class="line">	Topic: <span class="built_in">test</span>	Partition: 1	Leader: 1	Replicas: 1,2,0	Isr: 1,2,0</span><br><span class="line">	Topic: <span class="built_in">test</span>	Partition: 2	Leader: 2	Replicas: 2,0,1	Isr: 2,0,1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有topic(查看已有的topic)</span></span><br><span class="line">[root@kafka1 config]# kafka-topics.sh --list --zookeeper master:2181,slave1:2181,slave2:2181</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>参数解释：</p>
<ul>
<li><code>--create</code>：表示你要创建一个新的 Kafka 主题。</li>
<li><code>--zookeeper master:2181,slave1:2181,slave2:2181</code>：指定了 Zookeeper 的连接字符串。Zookeeper 用于管理和协调 Kafka 经纪人。</li>
<li><code>--partitions 3</code>：设置主题的分区数。在这里，主题将有 3 个分区。</li>
<li><code>--replication-factor 3</code>：定义主题的复制因子。每个分区将在不同的 Kafka 经纪人上具有三个副本，以实现容错。</li>
<li><code>--topic test</code>：指定 Kafka 主题的名称，在这里是 “test”。</li>
</ul>
<p><strong>生产消息</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kafka-console-producer.sh --broker-list master:9092,slave1:9092,slave2:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt;this is a <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p><strong>消费消息</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@slave1 ~]#  kafka-console-consumer.sh --bootstrap-server master:9092,slave1:9092,slave2:9092 --topic <span class="built_in">test</span> --from-beginning</span><br><span class="line">this is a <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在1号即发消息，这里能收到消息</span></span><br></pre></td></tr></table></figure>

<p><strong>删除消息</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kafka-topics.sh --zookeeper master:2181,slave1:2181,slave2:2181 --delete --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051834237.png" alt="image-20240105183425150"></p>
<p>kafka可视化工具(略)</p>
<p>官网:<a target="_blank" rel="noopener" href="https://www.kafkatool.com/download.html">https://www.kafkatool.com/download.html</a></p>
<p>文档参考:<a target="_blank" rel="noopener" href="https://www.freesion.com/article/72661130783/">https://www.freesion.com/article/72661130783/</a></p>
<p>博客:</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401051825380.png" alt="image-20240105182538256"></p>
<p>官网:</p>
<p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161013794.png" alt="image-20240116101350654"></p>
<p>ubuntu版本直接拉取脚本运行安装即可:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.kafkatool.com/download2/offsetexplorer.sh</span><br><span class="line"><span class="built_in">sudo</span> sh offsetexplorer.sh</span><br></pre></td></tr></table></figure>

<p>完成!!</p>

                
                <p class="end">__END__</p>
            </div>
            <div class="article-footer">
                <div class="suffix-box">
    <div class="suffix-box-left">
        <img src="/image/sidebar/avatar_wyl.jpg" alt="wylblog">
    </div>
    <div class="suffix-box-right">
        <span class="suffix-box-title">文章作者：</span>wylblog
        <br>
        <span class="suffix-box-title">文章出处：</span><a href="/2024/11/08/04-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-zookeeper-kafka/" target="_blank">04.消息队列-zookeeper+kafka</a>
        <br>
        <span class="suffix-box-title">作者签名：</span>简单地活着, 肆意又精彩.
        <br>
        <span class="suffix-box-title">关于主题：</span><a href="https://github.com/first19326/Hexo-LiveForCode" target="_blank">Hexo - Live For Code</a>
        <br>
        <span class="suffix-box-title">版权声明：</span>文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" title="BY-NC-SA" target="_blank">BY-NC-SA</a> 许可协议，转载请注明出处
        <br>
    </div>
    <div style="clear: both;"></div>
</div>
                
                
                    <div class="tag">
                        标签：
                        
                            <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%BF%90%E7%BB%B4/">大数据运维</a>
                        
                    </div>
                
                <div class="article-prev-next">
                    
                        <a href="/2024/11/08/05-Hbase%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2/" class="prev-prefix">« </a> 上一篇：    <a href="/2024/11/08/05-Hbase%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2/" title="发布于 2024-11-08 03:22">05.Hbase完全分布式部署</a>
                        <br>
                    
                    
                        <a href="/2024/11/08/03-Hive%E4%B9%8BHiveserver2-metastore%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/" class="next-prefix">» </a> 下一篇：    <a href="/2024/11/08/03-Hive%E4%B9%8BHiveserver2-metastore%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/" title="发布于 2024-11-08 03:19">03.Hive之Hiveserver2 metastore环境部署</a>
                    
                </div>
            </div>
            
    <div class="article-comments">
        
            <div class="comments-title">
                评论列表
            </div>
        
        <div class="comments-content"></div>
    </div>
    
 
        </div>
    
</div>
    <div id="footer">
    <div><span class='face'>ღゝ◡╹)ノ♡</span></div><div>【人生若只如初见<span><i class='iconfont icon-like-fill'></i></span>何事秋风悲画扇】</div><div>&copy; 2020-2023 WorstOne. All Rights Reserved.</div>
</div>
    <div id="sidebar">
    <div class="menu-wrap" style="display:none;">
        
            <div class="menu-notice">
                <span class="iconfont icon-notice"></span>
                <div class="notice">
                    <span>简单地活着，肆意而又精彩！</span>
                </div>
            </div>
        
        <nav class="menu">
            <div class="menu-introduce"> 
                <div class="introduce-avatar">
                    <img src="/image/sidebar/avatar_wyl.jpg">
                </div> 
                <div class="introduce-info"> 
                    <div class="introduce-user">
                        
                            <a href="https://devwyl1013.github.io" target="_blank"><span>wylblog</span></a>
                        
                    </div>
                </div> 
            </div> 
            <div class="menu-list">
                <ul>
                    
                        <li class=""><a href="/" class="" target="_self"><span class="iconfont icon-home-fill"></span>首页</a></li>
                    
                        <li class=""><a href="/category" class="" target="_self"><span class="iconfont icon-folder-fill"></span>分类</a></li>
                    
                        <li class=""><a href="/tag" class="" target="_self"><span class="iconfont icon-discount-fill"></span>标签</a></li>
                    
                        <li class=""><a href="/about" class="" target="_self"><span class="iconfont icon-about-fill"></span>关于</a></li>
                    
                        <li class=""><a href="/comment" class="" target="_self"><span class="iconfont icon-comments-fill"></span>留言板</a></li>
                    
                        <li class=""><a href="/friend" class="" target="_self"><span class="iconfont icon-link"></span>友情链接</a></li>
                    
                </ul> 
            </div> 
            <div class="menu-link">
                <div class="box">
                    <div class="image-box"></div>
                </div>
                
                    <a name="gitee" href="https://gitee.com/master_hj" class="" target="_blank" data=""><span class="iconfont icon-gitee"></span></a>
                
                    <a name="微博" href="https://m.weibo.cn/u/5566622835?t=0&luicode=10000011&lfid=231583" class="" target="_blank" data=""><span class="iconfont icon-weibo"></span></a>
                
                    <a name="QQ" href="javascript:;" class="image" target="_self" data="/image/sidebar/qq.jpg"><span class="iconfont icon-qq"></span></a>
                
                    <a name="微信" href="javascript:;" class="image" target="_self" data="/image/sidebar/wx.jpg"><span class="iconfont icon-wechat"></span></a>
                
                    <a name="GitHub" href="https://github.com/wylblog" class="" target="_blank" data=""><span class="iconfont icon-github"></span></a>
                
            </div> 
        </nav>
        <button class="menu-button-close"></button>
        <div class="morph-shape" id="morph-shape" data-morph-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">
                <path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"/>
            </svg>
        </div>
    </div>
    <button class="menu-button-open">MENU</button>
    <div class="menu-cover"></div>
</div>
    <link type="text/css" rel="stylesheet" href="/css/search.css">
<script type="text/javascript" src="/js/iscroll.js"></script>
<script type="text/javascript" src="/js/instantsearch.min.js"></script>
<div class="search-window">
    <div class="search-content">
        <div class="search-content-icon">
            <i class="iconfont icon-search"></i>
        </div>
        <div id="search-input" class="search-input"></div>
    </div>

    <div class="search-scroll">
        <div class="search-result">
            <div id="search-stats" class="search-stats"></div>
            <div id="search-hits"></div>
            <div id="search-pagination" class="search-pagination"></div>
        </div>
    </div>

    <span class="search-close-icon">
        <i class="iconfont icon-close"></i>
    </span>
</div>
    <div id="tools">
    <div class="progressbar-top"></div>
    
    <link type="text/css" rel="stylesheet" href="/css/APlayer.css">
    <script type="text/javascript" src="/js/APlayer.min.js"></script>
    <script type="text/javascript" src="/js/Meting.min.js"></script>
    <script>
        var meting_api = 'https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&auth=:auth&r=:r';
    </script>
    <meting-js id="3778678" lrcshow="false" server="netease" type="playlist" fixed="true" autoplay="false" loop="all" order="random" preload="auto" volume="0.67" mutex="true"></meting-js>

    <div class="wrap-right">
    <div class="wrap-right-hide">
         <div class="wrap-right-button favorites">
            <div class="iconbox" switch="false">
                <span class="iconfont icon-favorites"></span>
            </div>
            <span class="icontext">关注</span>
         </div>
        <div class="wrap-right-button search">
            <div class="iconbox">
                <span class="iconfont icon-search-menu"></span>
            </div>
            <span class="icontext">搜索</span>
        </div>
        <div class="wrap-right-button menu-button">
            <div class="iconbox">
                <span class="iconfont icon-menu"></span>
            </div>
            <span class="icontext">菜单</span>
        </div>
        <div class="wrap-right-button mode">
            <div class="light">
                <div class="iconbox">
                    <span class="iconfont icon-daymode"></span>
                </div>
                <span class="icontext">浅色模式</span>
            </div>
            <div class="dark">
                <div class="iconbox">
                    <span class="iconfont icon-nightmode-fill"></span>
                </div>
                <span class="icontext">深色模式</span>
            </div>
        </div>
        <div class="wrap-right-button bottom">
            <div class="iconbox">
                <span class="iconfont icon-top"></span>
            </div>
            <span class="icontext">跳至底部</span>
        </div>
    </div>
    <div class="wrap-right-show">
        <div class="wrap-right-button set">
            <div class="iconbox">
                <span class="iconfont icon-setting"></span>
            </div>
            <span class="icontext">设置</span>
        </div>
        <div class="wrap-right-button top">
            <div class="iconbox">
                <span class="iconfont icon-top"></span>
            </div>
            <span class="icontext">返回顶部</span>
        </div>
    </div>
</div>
    <div class="loading"></div>
</div>
    <script>
    window.config = {
        GitHubUserName     : "wylblog",
        GitHubRepositories : "無以菱的博客",

        User             : "wylblog",
        UserAvatar       : "/image/sidebar/avatar_wyl.jpg",
        WebsiteStartDate : "2020-10-13",
        Home             : "https://devwyl1013.github.io",

        WebsiteTitleBlur         : "(◍´꒳`◍) Hi, 期待你的到来",
        WebsiteTitleBlurTimeOut  : 500,
        WebsiteTitleFocus        : "(*´∇｀*) 欢迎回来!",
        WebsiteTitleFocusTimeOut : 1000,
        WebsiteFavicon           : {
            light : "/image/website/logo/logo.png",
            dark  : "/image/website/logo/logo-dark.png"
        },

        ProgressBar : {
            id       : "topProgressBar",
            color    : "#77B6FF",
            height   : "2px",
            duration : 0.2
        },

        Loading: {
            rebound : {
                tension  : 16,
                friction : 5
            },
            spinner : {
                id     : "spinner",
                radius : 90,
                sides  : 3,
                depth  : 4,
                colors : {
                    background : "#F0F0F0",
                    stroke     : "#272633",
                    base       : "",
                    child      : "#272633"
                },
                alwaysForward : true,
                restAt        : 0.5,
                renderBase    : false
            }
        },

        HomeHeaderAnimationRendered : true,
        HomeHeaderAnimation         : {
            radius      : 15,
            density     : 0.2,
            color       : "rgba(255, 255, 255, .2)",
            clearOffset : 0.3
        },

        BackAnimationRendered          : true,
        IEBrowserBackAnimationRendered : false,
        BackAnimation                  : {
            colorSaturation  : "60%",
            colorBrightness  : "50%",
            colorAlpha       : 0.5,
            colorCycleSpeed  : 5,
            verticalPosition : "random",
            horizontalSpeed  : 200,
            ribbonCount      : 3,
            strokeSize       : 0,
            parallaxAmount   : -0.2,
            animateSections  : true
        },

        HomeHeaderImage : [
            
                "/image/header/home.jpg",
            
                "/image/header/home.jpeg",
            
        ],
        HomeBannerText  : "",

        ArticleHeaderImage : [
            
                "/image/header/article.jpg",
            
        ],

        OtherBannerText : "",

        Error : {
            icon    : "icon-swimming",
            title   : "PAGE NOT FOUND",
            content : [
                
                    "很抱歉，您访问的页面不存在！",
                
                    "可能是输入地址有误或该地址已变更。",
                
            ],
            buttons : [
                
                    {
                        icon  : "icon-home",
                        text  : "返回首页",
                        href  : "/",
                        class : ""
                    },
                
            ]
        },

        MenuNotice : {
            enable : true,
            notice : "简单地活着，肆意而又精彩！",
            speed  : 20
        },
        MenuList : [
            
                {
                    name   : "首页",
                    icon   : "icon-home-fill",
                    href   : "/",
                    type   : "index",
                    class  : "",
                    target : "_self"
                },
            
                {
                    name   : "分类",
                    icon   : "icon-folder-fill",
                    href   : "/category",
                    type   : "category",
                    class  : "",
                    target : "_self"
                },
            
                {
                    name   : "标签",
                    icon   : "icon-discount-fill",
                    href   : "/tag",
                    type   : "tag",
                    class  : "",
                    target : "_self"
                },
            
                {
                    name   : "关于",
                    icon   : "icon-about-fill",
                    href   : "/about",
                    type   : "about",
                    class  : "",
                    target : "_self"
                },
            
                {
                    name   : "留言板",
                    icon   : "icon-comments-fill",
                    href   : "/comment",
                    type   : "comment",
                    class  : "",
                    target : "_self"
                },
            
                {
                    name   : "友情链接",
                    icon   : "icon-link",
                    href   : "/friend",
                    type   : "friend",
                    class  : "",
                    target : "_self"
                },
            
        ],
        MenuLink : [
            
                
                    {
                        name   : "gitee",
                        icon   : "icon-gitee",
                        href   : "https://gitee.com/master_hj",
                        class  : "",
                        target : "_blank",
                        image  : ""
                    },
                
                    {
                        name   : "微博",
                        icon   : "icon-weibo",
                        href   : "https://m.weibo.cn/u/5566622835?t=0&luicode=10000011&lfid=231583",
                        class  : "",
                        target : "_blank",
                        image  : ""
                    },
                
                    {
                        name   : "QQ",
                        icon   : "icon-qq",
                        href   : "javascript:;",
                        class  : "image",
                        target : "_self",
                        image  : "/image/sidebar/qq.jpg"
                    },
                
                    {
                        name   : "微信",
                        icon   : "icon-wechat",
                        href   : "javascript:;",
                        class  : "image",
                        target : "_self",
                        image  : "/image/sidebar/wx.jpg"
                    },
                
                    {
                        name   : "GitHub",
                        icon   : "icon-github",
                        href   : "https://github.com/wylblog",
                        class  : "",
                        target : "_blank",
                        image  : ""
                    },
                
            
        ],

        FooterStyle : 2,
        BottomText  : "<div><span class='face'>ღゝ◡╹)ノ♡</span></div><div>【人生若只如初见<span><i class='iconfont icon-like-fill'></i></span>何事秋风悲画扇】</div><div>&copy; 2020-2023 WorstOne. All Rights Reserved.</div>",

        ConsoleList : [
            
                
                    [
                        
                            
                                "Based on cnblogs theme SimpleMemory.",
                            
                                "",
                            
                        
                    ],
                
                    [
                        
                            
                                "SimpleMemory Author:",
                            
                                "BNDong",
                            
                        
                    ],
                
                    [
                        
                            
                                "Theme:",
                            
                                "LiveForCode",
                            
                        
                    ],
                
            
        ],

        FontIconExtend : "",

        Donate : {
            paypal  : "",
            bitcoin : "",
            alipay  : "/image/donate/alipay.png",
            wechat  : "/image/donate/wechat.png"
        },

        Search : {
            applicationID : "010C3EANT8",
            apiKey        : "c7abab9f11b79102b9aff7fe6d41447d",
            indexName     : "Notes",
            hits          : {
                page : 10
            },
            labels        : {
                placeholder : "搜索",
                empty       : "未发现与 「${query}」 相关的内容",
                stats       : "${hits} 条相关条目，使用了 ${time} 毫秒",
            }
        }, 

        Comment : {
            switch : true,
            type   : "Valine",
        },

        Waline : {
            el              : ".comments-content",
            serverURL       : "",
            path            : window.location.pathname,
            meta            : "['nick', 'mail', 'link']",
            requiredMeta    : "['nick', 'mail']",
            pageSize        : 10,
            lang            : "zh-cn",
            locale: {
                admin       : "博主",
                anonymous   : "匿名用户",
                sofa        : "快来做第一个评论的人吧 ~",
                placeholder : "你是我一生只会遇见一次的惊喜...",
            },
            dark            : "html[color-scheme='dark']",
            search          : false,
            pageview        : true,
            comment         : true,
            copyright       : false,
        },

        Valine : {
            el             : ".comments-content",
            appId          : "srhKtvWPQTWYKh3qX8G8M7v0-gzGzoHsz",
            appKey         : "8uVSP1q6UlALVC5igYfIfv2h",
            serverURLs     : "",
            placeholder    : "你是我一生只会遇见一次的惊喜...",
            avatar         : "mm",
            meta           : "nick,mail,link",
            requiredFields : "nick,mail",
            pageSize       : 5,
            lang           : "zh-cn",
            visitor        : true,
            enableQQ       : true
        },

        Tocbot : {
            switch                : true,
            tocSelector           : ".toc",
            contentSelector       : ".article-body",
            headingSelector       : "h1, h2, h3, h4, h5",
            headingsOffset        : 0,
            scrollSmooth          : true,
            scrollSmoothOffset    : -5,
            positionFixedSelector : ".toc",
            positionFixedClass    : "toc-fixed",
            fixedSidebarOffset    : "",
        },

        Require : {
            baseUrl     : "/js/",
            waitSeconds : 100
        },

        Music : {
            type : "Meting"
        },
        APlayer : {
            container : ".aplayer",
            fixed     : true,
            autoplay  : false,
            loop      : "all",
            order     : "random",
            preload   : "auto",
            volume    : 0.67,
            mutex     : true,
            lrcType   : 3,
            audio     : [
                
                    {
                        name   : "Endless Tears",
                        artist : "CLIFF EDGE",
                        cover  : "/music/cover/Endless Tears.jpg",
                        url    : "/music/song/Endless Tears.mp3",
                        lrc    : "/music/lrc/Endless Tears.lrc"
                    },
                
            ]
        },
        Meting : {
            api      : "https://api.i-meto.com/meting/api",
            id       : "3778678", 
            lrcshow  : false, 
            server   : "netease", 
            type     : "playlist", 
            fixed    : true, 
            autoplay : false, 
            loop     : "all", 
            order    : "random", 
            preload  : "auto", 
            volume   : 0.67, 
            mutex    : true
        },

        Mouse : {
            enable  : true,
            options : {
                size  : 6,
                sizeF : 24
            }
        },

        LazyLoad : {
            default : "/image/website/lazyload.svg"
        },
  
        Style : {
            aplayer          : "/css/APlayer.css",
            archive          : "/css/archive.css",
            base             : "/css/base.css",
            clipboard        : "/css/clipboard.css",
            code             : "/css/code.css",
            donate           : "/css/donate.css",
            fancybox         : "/css/jquery.fancybox.css",
            footer           : "/css/footer.css",
            iconfont         : "/iconfont/iconfont.css",
            index            : "/css/index.css",
            menuBubble       : "/css/menu-bubble.css",
            mouse            : "/css/mouse.css",
            page             : "/css/page.css",
            post             : "/css/post.css",
            search           : "/css/search.css",
            tocbot           : "/css/tocbot.css",
            valine           : "/css/valine.css",
            waline           : "/css/waline.css",
            walineCustom     : "/css/waline-custom.css"
        },

        Script: {
            aplayer          : "/js/APlayer.min.js",
            config           : "/js/require.config.js",
            index            : "/js/index.js",
            instantSearch    : "/js/instantsearch.min.js",
            iscroll          : "/js/iscroll.js",
            jQuery           : "/js/jquery-3.4.1.min.js",
            loading          : "/js/loading.js",
            meting           : "/js/Meting.min.js",
            require          : "/js/require.min.js",
            waline           : "/js/waline.mjs",
            pageview         : "/js/pageview.mjs",
            comment          : "/js/comment.mjs",
        },

        Font: {
            LongCang    : "/font/LongCang.css",
            Monda       : "/font/Monda.css",
            NotoSansSC  : "/font/NotoSansSC.css",
            NotoSerifSC : "/font/NotoSerifSC.css",
            Playball    : "/font/Playball.css",
            PTMono      : "/font/PTMono.css",
            Roboto      : "/font/Roboto.css",
            RobotoSlab  : "/font/RobotoSlab.css",
            Rosario     : "/font/Rosario.css",
            UbuntuMono  : "/font/UbuntuMono.css"
        },

        Suffix : {
            about : "简单地活着, 肆意又精彩."
        },
            
        Theme : {
            url  : "https://github.com/first19326/Hexo-LiveForCode",
            name : "Hexo - Live For Code"
        }  
    };
</script>
    <script type="text/javascript" src="/js/index.js"></script>
</body>
</html>